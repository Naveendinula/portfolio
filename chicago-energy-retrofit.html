<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chicago Buildings Retrofit Map</title>
    <link href='https://api.mapbox.com/mapbox-gl-js/v3.0.1/mapbox-gl.css' rel='stylesheet' />
    <link href='https://fonts.googleapis.com/css2?family=JetBrains+Mono:ital,wght@0,100..800;1,100..800&display=swap' rel='stylesheet' />
    <script src='https://api.mapbox.com/mapbox-gl-js/v3.0.1/mapbox-gl.js'></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        html, body { 
            height: 100%; 
            width: 100%;
            overflow: hidden;
            font-family: 'JetBrains Mono', 'Consolas', 'Monaco', 'Courier New', monospace;
            background: #000;
            color: white;
        }
        
        #map { 
            position: absolute; 
            top: 0; 
            left: 0;
            bottom: 0; 
            right: 0;
            width: 100%; 
            height: 100%;
        }
        
        .control-panel {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 20px;
            width: 280px;
            max-height: 80vh;
            overflow-y: auto;
            scrollbar-width: thin;
            scrollbar-color: rgba(96, 165, 250, 0.6) rgba(255, 255, 255, 0.1);
        }
        
        /* Modern Webkit Scrollbar */
        .control-panel::-webkit-scrollbar {
            width: 8px;
        }
        
        .control-panel::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 4px;
            margin: 4px;
        }
        
        .control-panel::-webkit-scrollbar-thumb {
            background: linear-gradient(180deg, rgba(96, 165, 250, 0.8), rgba(59, 130, 246, 0.6));
            border-radius: 4px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
        }
        
        .control-panel::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(180deg, rgba(96, 165, 250, 1), rgba(59, 130, 246, 0.8));
            transform: scale(1.1);
            box-shadow: 0 0 8px rgba(96, 165, 250, 0.4);
        }
        
        .control-panel::-webkit-scrollbar-thumb:active {
            background: linear-gradient(180deg, rgba(59, 130, 246, 1), rgba(37, 99, 235, 0.9));
        }
        
        .control-panel::-webkit-scrollbar-corner {
            background: transparent;
        }
        
        .control-panel h2 {
            margin-bottom: 20px;
            color: #60a5fa;
            font-size: 18px;
        }
        
        .control-group {
            margin-bottom: 15px;
        }
        
        .control-group label {
            display: block;
            margin-bottom: 5px;
            font-size: 14px;
            color: #cbd5e1;
        }
        
        .control-group select,
        .control-group input[type="checkbox"] {
            width: 100%;
            padding: 8px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 6px;
            background: rgba(30, 30, 30, 0.9);
            color: white;
            font-size: 14px;
        }
        
        .control-group select option {
            background: #1e1e1e;
            color: white;
            padding: 8px 12px;
        }
        
        .control-group select:focus {
            outline: none;
            border-color: #60a5fa;
            box-shadow: 0 0 0 2px rgba(96, 165, 250, 0.2);
        }
        
        .control-group input[type="checkbox"] {
            width: auto;
            margin-right: 8px;
        }
        
        .control-group input[type="number"] {
            width: 100%;
            padding: 8px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 6px;
            background: rgba(30, 30, 30, 0.9);
            color: white;
            font-size: 14px;
        }
        
        .control-group input[type="number"]:focus {
            outline: none;
            border-color: #60a5fa;
            box-shadow: 0 0 0 2px rgba(96, 165, 250, 0.2);
        }
        
        .stats-section {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .stat-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 14px;
        }
        
        .stat-value {
            color: #60a5fa;
            font-weight: bold;
        }
        
        .legend {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
            font-size: 13px;
        }
        
        .legend-color {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        #loading {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .mapboxgl-popup-content {
            background: rgba(0, 0, 0, 0.9) !important;
            color: white !important;
            border: 1px solid rgba(255, 255, 255, 0.1) !important;
            border-radius: 8px !important;
        }
        
        .mapboxgl-popup-tip {
            border-top-color: rgba(0, 0, 0, 0.9) !important;
        }

        /* Back button styling */
        .back-button {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 12px 16px;
            color: white;
            text-decoration: none;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s ease;
            z-index: 1000;
        }
        
        .back-button:hover {
            background: rgba(96, 165, 250, 0.2);
            border-color: rgba(96, 165, 250, 0.5);
            color: #60a5fa;
        }
        
        .back-button i {
            margin-right: 8px;
        }
    </style>
</head>
<body>
    <!-- Back to Portfolio Button -->
    <a href="portfolio.html" class="back-button">
        <i class="fas fa-arrow-left"></i>
        Back to Portfolio
    </a>

    <div id="map"></div>
    
    <div class="control-panel">
        <h2>Chicago Buildings</h2>
        
        <!-- Building View Section -->
        <div class="control-group">
            <label>Building View:</label>
            <div style="display: flex; flex-direction: column; gap: 5px;">
                <button id="all-buildings" class="view-button active" style="background: #2563eb; color: white; border: none; padding: 10px; border-radius: 6px; cursor: pointer;">
                    All Buildings
                </button>
                <button id="retrofit-candidates" class="view-button" style="background: transparent; color: #60a5fa; border: 1px solid #60a5fa; padding: 10px; border-radius: 6px; cursor: pointer;">
                    Retrofit Candidates
                </button>
            </div>
        </div>
        
        <!-- Priority Filter -->
        <div class="control-group">
            <label for="priority-filter">Priority Filter:</label>
            <select id="priority-filter">
                <option value="">All Priorities</option>
                <option value="Critical">Critical</option>
                <option value="High">High</option>
                <option value="Medium">Medium</option>
                <option value="Low">Low</option>
                <option value="Minimal">Minimal</option>
            </select>
        </div>
        
        <!-- Property Type -->
        <div class="control-group">
            <label for="property-type">Property Type:</label>
            <select id="property-type">
                <option value="">All Types</option>
                <option value="Office">Office</option>
                <option value="Mixed Use Property">Mixed Use Property</option>
                <option value="K-12 School">K-12 School</option>
                <option value="Residential">Residential</option>
                <option value="Commercial">Commercial</option>
                <option value="College/University">College/University</option>
                <option value="Hospital">Hospital</option>
                <option value="Other - Mall">Other - Mall</option>
                <option value="Bank Branch">Bank Branch</option>
                <option value="Automobile Dealership">Automobile Dealership</option>
            </select>
        </div>
        
        <!-- Energy Star Score Range -->
        <div class="control-group">
            <label>Energy Star Score:</label>
            <div style="display: flex; gap: 10px; align-items: center;">
                <input type="number" id="energy-min" placeholder="Min" min="1" max="100" 
                       style="flex: 1; padding: 8px; border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 6px; background: rgba(255, 255, 255, 0.1); color: white; font-size: 14px;">
                <span style="color: #cbd5e1;">to</span>
                <input type="number" id="energy-max" placeholder="Max" min="1" max="100"
                       style="flex: 1; padding: 8px; border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 6px; background: rgba(255, 255, 255, 0.1); color: white; font-size: 14px;">
            </div>
        </div>
        
        <!-- Filter Buttons -->
        <div class="control-group" style="margin-top: 20px;">
            <button id="apply-filters" style="width: 100%; padding: 12px; background: #7c3aed; color: white; border: none; border-radius: 6px; cursor: pointer; margin-bottom: 8px; font-weight: bold;">
                Apply Filters
            </button>
            <button id="clear-filters" style="width: 100%; padding: 10px; background: transparent; color: #94a3b8; border: 1px solid #94a3b8; border-radius: 6px; cursor: pointer; margin-bottom: 8px;">
                ✕ Clear Filters
            </button>
            <button id="fit-to-data" style="width: 100%; padding: 10px; background: transparent; color: #06b6d4; border: 1px solid #06b6d4; border-radius: 6px; cursor: pointer;">
                Fit to Data
            </button>
        </div>
        
        <!-- Clustering Toggle -->
        <div class="control-group" style="margin-top: 20px; padding-top: 20px; border-top: 1px solid rgba(255, 255, 255, 0.1);">
            <label>
                <input type="checkbox" id="show-clusters" checked>
                Enable Clustering
            </label>
        </div>
        
        <div class="stats-section">
            <h3 style="margin-bottom: 15px; font-size: 16px;">Statistics</h3>
            <div class="stat-item">
                <span>Total Buildings:</span>
                <span id="total-buildings" class="stat-value">-</span>
            </div>
            <div class="stat-item">
                <span>Critical Priority:</span>
                <span id="critical-count" class="stat-value">-</span>
            </div>
            <div class="stat-item">
                <span>Avg Energy Score:</span>
                <span id="avg-energy-score" class="stat-value">-</span>
            </div>
        </div>
        
        <!-- Algorithm Info -->
        <div class="legend">
            <h3 style="margin-bottom: 10px; font-size: 14px;">⚙️ Retrofit Algorithm</h3>
            <p style="font-size: 11px; color: #94a3b8; margin-bottom: 8px;">
                Priority calculated using weighted scoring:
            </p>
            <div style="font-size: 10px; color: #cbd5e1; line-height: 1.3;">
                <div>• Energy Star Rating (30%)</div>
                <div>• Chicago Energy Rating (25%)</div>
                <div>• Site EUI (20%)</div>
                <div>• Building Age (15%)</div>
                <div>• GHG Intensity (10%)</div>
            </div>
        </div>
        
        <div class="legend">
            <h3 style="margin-bottom: 10px; font-size: 14px;">Priority Levels</h3>
            <div class="legend-item">
                <div class="legend-color" style="background: #dc2626;"></div>
                <span style="font-size: 11px;">Critical (80-100)</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #ea580c;"></div>
                <span style="font-size: 11px;">High (60-79)</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #d97706;"></div>
                <span style="font-size: 11px;">Medium (40-59)</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #65a30d;"></div>
                <span style="font-size: 11px;">Low (20-39)</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #059669;"></div>
                <span style="font-size: 11px;">Minimal (0-19)</span>
            </div>
        </div>
    </div>
    
    <div id="loading">
        <div style="text-align: center;">
            <div style="border: 3px solid #333; border-top: 3px solid #60a5fa; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; margin: 0 auto 15px;"></div>
            <p>Loading...</p>
        </div>
    </div>
    
    <script src="assets/js/chicago-retrofit-main.js"></script>
</body>
</html>
